<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDA Enhanced Scope of Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8fafc;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #01549e 0%, #507ABB 100%);
            color: white;
            padding: 24px 32px;
            border-radius: 12px;
            text-align: left;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(1, 84, 158, 0.2);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 15px;
            opacity: 0.95;
        }

        .instructions {
            text-align: center;
            color: #666;
            margin-bottom: 24px;
            font-size: 15px;
            font-weight: 500;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
            border-color: #01549e;
        }

        .card:focus {
            outline: 3px solid #be5510;
            outline-offset: 2px;
        }

        .card-badge {
            display: inline-block;
            background: linear-gradient(135deg, #be5510 0%, #cb6015 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #01549e;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .card-preview {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .card-cta {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #01549e;
            font-weight: 600;
            font-size: 14px;
            transition: gap 0.2s ease;
        }

        .card:hover .card-cta {
            gap: 10px;
        }

        .card-cta::after {
            content: 'â†’';
            font-size: 16px;
        }

        /* Explored card indicator */
        .card.explored {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .card.explored::after {
            content: 'âœ“';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .card.explored .card-cta {
            color: #10b981;
        }

        .card.explored:hover {
            border-color: #059669;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #01549e 0%, #507ABB 100%);
            color: white;
            padding: 24px 32px;
            border-radius: 16px 16px 0 0;
            position: relative;
        }

        .modal-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .modal-icon {
            font-size: 56px;
            margin-bottom: 12px;
            display: block;
        }

        .modal-title {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .modal-subtitle {
            font-size: 15px;
            opacity: 0.95;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 24px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 28px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            line-height: 1;
            padding: 0;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-close:focus {
            outline: 3px solid #be5510;
            outline-offset: 2px;
        }

        .modal-body {
            padding: 32px;
        }

        .modal-section {
            margin-bottom: 28px;
        }

        .modal-section:last-child {
            margin-bottom: 0;
        }

        .modal-section-title {
            font-size: 18px;
            font-weight: 700;
            color: #01549e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #be5510 0%, #cb6015 100%);
            border-radius: 2px;
        }

        .modal-section-content {
            font-size: 15px;
            color: #4a5568;
            line-height: 1.7;
        }

        .modal-section-content strong {
            color: #01549e;
            font-weight: 600;
        }

        .modal-list {
            list-style: none;
            margin: 12px 0;
        }

        .modal-list li {
            padding-left: 28px;
            position: relative;
            margin-bottom: 10px;
        }

        .modal-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #be5510;
            font-weight: bold;
            font-size: 16px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #fff5ec 0%, #ffe8d9 100%);
            border-left: 4px solid #be5510;
            padding: 16px 20px;
            border-radius: 8px;
            margin: 16px 0;
        }

        .highlight-box-title {
            font-weight: 700;
            color: #be5510;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .highlight-box-content {
            color: #744210;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-bar {
            background: white;
            padding: 20px 28px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            margin-bottom: 24px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 15px;
        }

        .progress-label {
            font-weight: 600;
            color: #333;
        }

        .progress-count {
            font-weight: 700;
            color: #01549e;
        }

        .progress-track {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #be5510 0%, #cb6015 100%);
            border-radius: 5px;
            transition: width 0.4s ease;
            width: 0%;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* Completion Message */
        .completion-message {
            display: none;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 28px 32px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            animation: slideUp 0.4s ease;
        }

        .completion-message.show {
            display: block;
        }

        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .completion-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .completion-message h3 {
            font-size: 24px;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .completion-message p {
            font-size: 16px;
            opacity: 0.95;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .header {
                padding: 20px 24px;
            }

            .header h1 {
                font-size: 22px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .modal {
                margin: 0;
                max-height: 90vh;
            }

            .modal-header {
                padding: 20px 24px;
            }

            .modal-icon {
                font-size: 44px;
            }

            .modal-title {
                font-size: 22px;
            }

            .modal-body {
                padding: 24px;
            }

            .modal-close {
                top: 16px;
                right: 20px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1025px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>RDA Enhanced Scope of Practice</h1>
            <p>Discover the exclusive duties and opportunities available with your RDA certification</p>
        </header>

        <p class="instructions" role="status">Click any card to explore detailed information about each RDA-exclusive capability. Use Tab to navigate, Enter or Space to open cards.</p>

        <main>
        <h2 class="sr-only">RDA Exclusive Capabilities</h2>
        <div class="cards-grid" role="list">
            <div class="card" data-card="1" role="listitem" tabindex="0" aria-labelledby="card-title-1">
                <span class="card-badge" aria-label="RDA only certification">RDA Only</span>
                <span class="card-icon" aria-hidden="true">ðŸ“·</span>
                <h3 class="card-title" id="card-title-1">Dental Radiography</h3>
                <p class="card-preview">Take dental X-rays under general supervision</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>

            <div class="card" data-card="2" role="listitem" tabindex="0" aria-labelledby="card-title-2">
                <span class="card-badge" aria-label="RDA only certification">RDA Only</span>
                <span class="card-icon" aria-hidden="true">âœ¨</span>
                <h3 class="card-title" id="card-title-2">Coronal Polishing</h3>
                <p class="card-preview">Polish the visible surfaces of patient teeth</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>

            <div class="card" data-card="3" role="listitem" tabindex="0" aria-labelledby="card-title-3">
                <span class="card-badge" aria-label="RDA only certification">RDA Only</span>
                <span class="card-icon" aria-hidden="true">ðŸ’Š</span>
                <h3 class="card-title" id="card-title-3">Topical Anesthetics</h3>
                <p class="card-preview">Apply numbing agents to oral tissues</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>

            <div class="card" data-card="4" role="listitem" tabindex="0" aria-labelledby="card-title-4">
                <span class="card-badge" aria-label="RDA only certification">RDA Only</span>
                <span class="card-icon" aria-hidden="true">ðŸ”¬</span>
                <h3 class="card-title" id="card-title-4">Expanded Functions</h3>
                <p class="card-preview">Access to advanced delegated procedures</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>

            <div class="card" data-card="5" role="listitem" tabindex="0" aria-labelledby="card-title-5">
                <span class="card-badge" aria-label="RDA benefit">RDA Benefit</span>
                <span class="card-icon" aria-hidden="true">ðŸ“‹</span>
                <h3 class="card-title" id="card-title-5">General Supervision</h3>
                <p class="card-preview">Work independently without direct oversight</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>

            <div class="card" data-card="6" role="listitem" tabindex="0" aria-labelledby="card-title-6">
                <span class="card-badge" aria-label="RDA benefit">RDA Benefit</span>
                <span class="card-icon" aria-hidden="true">ðŸŽ¯</span>
                <h3 class="card-title" id="card-title-6">Career Advancement</h3>
                <p class="card-preview">Unlock leadership and specialty opportunities</p>
                <div class="card-cta" aria-hidden="true">Learn more</div>
            </div>
        </div>

        <div class="progress-bar" role="region" aria-label="Exploration progress">
            <div class="progress-text">
                <span class="progress-label">Your Progress</span>
                <span class="progress-count" aria-live="polite">0 of 6 explored</span>
            </div>
            <div class="progress-track" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="6" aria-label="Cards explored">
                <div class="progress-fill"></div>
            </div>
        </div>

        <div class="completion-message" role="alert" aria-live="assertive">
            <div class="completion-icon" aria-hidden="true">ðŸŽ‰</div>
            <h3>Congratulations!</h3>
            <p>You've explored all the enhanced duties and benefits available to Texas RDAs. These expanded capabilities set you apart from non-certified dental assistants and open doors to greater career opportunities!</p>
        </div>
        </main>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalSubtitle">
        <div class="modal" id="modal">
            <div class="modal-header">
                <button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
                <span class="modal-badge" id="modalBadge" aria-label="RDA only certification">RDA Only</span>
                <span class="modal-icon" id="modalIcon" aria-hidden="true">ðŸ“·</span>
                <h2 class="modal-title" id="modalTitle">Dental Radiography</h2>
                <p class="modal-subtitle" id="modalSubtitle">Take dental X-rays under general supervision</p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be dynamically inserted -->
            </div>
        </div>
    </div>

    <script>
        // Card data with detailed content
        const cardData = {
            '1': {
                badge: 'RDA Only',
                icon: 'ðŸ“·',
                title: 'Dental Radiography',
                subtitle: 'Take dental X-rays under general supervision',
                sections: [
                    {
                        title: 'What You Can Do',
                        content: 'As an RDA, you are authorized to take dental radiographs (X-rays) under <strong>general supervision</strong>. This is a significant privilege that distinguishes certified RDAs from non-certified dental assistants.'
                    },
                    {
                        title: 'Key Benefits',
                        list: [
                            'Take X-rays when the dentist is not physically present in the office',
                            'Work more efficiently and independently in the dental practice',
                            'Increase your value to employers who need this critical capability',
                            'Perform a clinical duty that requires specialized training and certification'
                        ]
                    },
                    {
                        title: 'Clinical Impact',
                        highlight: {
                            title: 'Why This Matters',
                            content: 'Radiography is essential for diagnosis, treatment planning, and monitoring patient care. Your ability to perform this duty under general supervision means you can help maintain smooth clinical operations even when the dentist is focusing on other tasks or not in the office.'
                        }
                    }
                ]
            },
            '2': {
                badge: 'RDA Only',
                icon: 'âœ¨',
                title: 'Coronal Polishing',
                subtitle: 'Polish the visible surfaces of patient teeth',
                sections: [
                    {
                        title: 'What You Can Do',
                        content: 'RDAs are authorized to perform <strong>coronal polishing</strong> - the polishing of the coronal (visible) portion of teeth using rubber cups with polishing paste. This cosmetic and preventive procedure is restricted to certified dental assistants.'
                    },
                    {
                        title: 'Procedure Details',
                        list: [
                            'Polish teeth to remove superficial stains and plaque after cleanings',
                            'Use slow-speed handpieces with rubber cups and polishing paste',
                            'Provide patients with immediate aesthetic improvement',
                            'Work on the crown portion of teeth only (above the gumline)'
                        ]
                    },
                    {
                        title: 'Professional Value',
                        highlight: {
                            title: 'Career Advantage',
                            content: 'Coronal polishing is a patient-favorite procedure that provides visible results. Being able to perform this duty makes you more valuable in general dentistry practices and enhances patient satisfaction with their dental visits.'
                        }
                    }
                ]
            },
            '3': {
                badge: 'RDA Only',
                icon: 'ðŸ’Š',
                title: 'Topical Anesthetics',
                subtitle: 'Apply numbing agents to oral tissues',
                sections: [
                    {
                        title: 'What You Can Do',
                        content: 'As an RDA, you can apply <strong>topical anesthetic agents</strong> to oral tissues. This helps numb areas before injections or certain dental procedures, improving patient comfort and reducing anxiety.'
                    },
                    {
                        title: 'Clinical Applications',
                        list: [
                            'Prepare patients for local anesthetic injections',
                            'Reduce discomfort during minor soft tissue procedures',
                            'Help anxious patients feel more comfortable',
                            'Apply gel, spray, or liquid anesthetic formulations'
                        ]
                    },
                    {
                        title: 'Patient Care Benefits',
                        highlight: {
                            title: 'Improving Patient Experience',
                            content: 'The ability to apply topical anesthetics allows you to play a direct role in patient comfort management. This relatively simple duty can significantly reduce patient anxiety and make dental procedures more tolerable.'
                        }
                    }
                ]
            },
            '4': {
                badge: 'RDA Only',
                icon: 'ðŸ”¬',
                title: 'Expanded Functions',
                subtitle: 'Access to advanced delegated procedures',
                sections: [
                    {
                        title: 'What You Can Do',
                        content: 'Your RDA certification opens the door to <strong>expanded functions</strong> as delegated by the dentist. With additional training, you can pursue EFDA (Expanded Functions Dental Assistant) certification to perform even more advanced clinical procedures.'
                    },
                    {
                        title: 'Growth Opportunities',
                        list: [
                            'Foundation for EFDA certification and advanced duties',
                            'Access to procedures beyond basic dental assisting',
                            'Ability to take on more clinical responsibilities',
                            'Increased earning potential with expanded skills'
                        ]
                    },
                    {
                        title: 'Career Path',
                        highlight: {
                            title: 'Building Your Future',
                            content: 'Think of your RDA as the foundation. With this certification, you have proven competency and gained eligibility for advanced training programs that can authorize you to perform procedures like placing restorations, taking impressions, and other reversible duties.'
                        }
                    }
                ]
            },
            '5': {
                badge: 'RDA Benefit',
                icon: 'ðŸ“‹',
                title: 'General Supervision',
                subtitle: 'Work independently without direct oversight',
                sections: [
                    {
                        title: 'What This Means',
                        content: '<strong>General supervision</strong> means the dentist has authorized and delegated specific procedures, but does not need to be physically present in the office while you perform them. This is a major distinction from direct supervision.'
                    },
                    {
                        title: 'Practical Advantages',
                        list: [
                            'Perform X-rays while the dentist is with other patients',
                            'Work more independently and efficiently',
                            'Demonstrate professional judgment and responsibility',
                            'Make yourself more valuable to employers'
                        ]
                    },
                    {
                        title: 'Professional Responsibility',
                        content: 'With general supervision privileges comes professional responsibility. You must work within your scope of practice, use proper clinical judgment, and ensure quality patient care even when the dentist is not immediately available.'
                    },
                    {
                        title: 'Workplace Impact',
                        highlight: {
                            title: 'Operational Efficiency',
                            content: 'General supervision allows dental practices to operate more efficiently. You can complete necessary procedures without interrupting the dentist\'s schedule, which improves workflow and patient throughput.'
                        }
                    }
                ]
            },
            '6': {
                badge: 'RDA Benefit',
                icon: 'ðŸŽ¯',
                title: 'Career Advancement',
                subtitle: 'Unlock leadership and specialty opportunities',
                sections: [
                    {
                        title: 'Professional Opportunities',
                        content: 'RDA certification is often <strong>required or strongly preferred</strong> for lead assistant positions, supervisory roles, and specialty practice positions. It demonstrates your commitment to professional development and clinical competency.'
                    },
                    {
                        title: 'Career Paths Open to RDAs',
                        list: [
                            'Lead Dental Assistant or Office Manager positions',
                            'Specialty practices (orthodontics, oral surgery, pediatrics)',
                            'Dental product sales and education representatives',
                            'Instructor positions at dental assisting programs',
                            'EFDA and other advanced certifications'
                        ]
                    },
                    {
                        title: 'Financial Benefits',
                        highlight: {
                            title: 'Increased Earning Potential',
                            content: 'RDAs typically earn higher hourly wages than non-certified assistants. The certification demonstrates verifiable skills and competencies that employers value, translating directly to better compensation and benefits.'
                        }
                    },
                    {
                        title: 'Long-Term Value',
                        content: 'Your RDA certification is a professional credential that stays with you throughout your career. It serves as proof of your training, competency, and commitment to the dental profession - opening doors now and in the future.'
                    }
                ]
            }
        };

        // DOM Elements
        const cards = document.querySelectorAll('.card');
        const modalOverlay = document.getElementById('modalOverlay');
        const modal = document.getElementById('modal');
        const modalClose = document.getElementById('modalClose');
        const modalBadge = document.getElementById('modalBadge');
        const modalIcon = document.getElementById('modalIcon');
        const modalTitle = document.getElementById('modalTitle');
        const modalSubtitle = document.getElementById('modalSubtitle');
        const modalBody = document.getElementById('modalBody');
        const progressFill = document.querySelector('.progress-fill');
        const progressCount = document.querySelector('.progress-count');
        const progressTrack = document.querySelector('.progress-track');
        const completionMessage = document.querySelector('.completion-message');

        let exploredCards = new Set();
        let lastFocusedElement = null;
        let focusableElements = [];
        let firstFocusableElement = null;
        let lastFocusableElement = null;

        // Open modal with card data
        function openModal(cardId) {
            const data = cardData[cardId];
            if (!data) return;

            // Store last focused element
            lastFocusedElement = document.activeElement;

            // Update modal content
            modalBadge.textContent = data.badge;
            modalBadge.setAttribute('aria-label', data.badge === 'RDA Only' ? 'RDA only certification' : 'RDA benefit');
            modalIcon.textContent = data.icon;
            modalTitle.textContent = data.title;
            modalSubtitle.textContent = data.subtitle;

            // Build modal body
            let bodyHTML = '';
            data.sections.forEach(section => {
                bodyHTML += '<div class="modal-section">';
                bodyHTML += `<h3 class="modal-section-title">${section.title}</h3>`;

                if (section.content) {
                    bodyHTML += `<div class="modal-section-content">${section.content}</div>`;
                }

                if (section.list) {
                    bodyHTML += '<ul class="modal-list">';
                    section.list.forEach(item => {
                        bodyHTML += `<li>${item}</li>`;
                    });
                    bodyHTML += '</ul>';
                }

                if (section.highlight) {
                    bodyHTML += '<div class="highlight-box">';
                    bodyHTML += `<div class="highlight-box-title">${section.highlight.title}</div>`;
                    bodyHTML += `<div class="highlight-box-content">${section.highlight.content}</div>`;
                    bodyHTML += '</div>';
                }

                bodyHTML += '</div>';
            });

            modalBody.innerHTML = bodyHTML;

            // Show modal
            modalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Setup focus trap
            setupFocusTrap();

            // Focus close button
            setTimeout(() => {
                modalClose.focus();
            }, 100);

            // Track exploration and mark card as explored
            exploredCards.add(cardId);
            const exploredCard = document.querySelector(`.card[data-card="${cardId}"]`);
            exploredCard.classList.add('explored');
            exploredCard.setAttribute('aria-label', exploredCard.querySelector('.card-title').textContent + ' - Explored');
            updateProgress();

            // Call postHeight after modal animation
            setTimeout(postHeight, 350);
        }

        // Close modal
        function closeModal() {
            modalOverlay.classList.remove('active');
            document.body.style.overflow = '';

            // Restore focus to last focused element
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }

            // Call postHeight after modal closes
            setTimeout(postHeight, 250);
        }

        // Setup focus trap
        function setupFocusTrap() {
            const focusableSelectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
            focusableElements = modal.querySelectorAll(focusableSelectors);

            if (focusableElements.length > 0) {
                firstFocusableElement = focusableElements[0];
                lastFocusableElement = focusableElements[focusableElements.length - 1];
            }
        }

        // Trap focus within modal
        function trapFocus(e) {
            if (e.key !== 'Tab') return;

            if (e.shiftKey) {
                // Shift + Tab
                if (document.activeElement === firstFocusableElement) {
                    lastFocusableElement.focus();
                    e.preventDefault();
                }
            } else {
                // Tab
                if (document.activeElement === lastFocusableElement) {
                    firstFocusableElement.focus();
                    e.preventDefault();
                }
            }
        }

        // Update progress
        function updateProgress() {
            const total = cards.length;
            const explored = exploredCards.size;
            const percentage = (explored / total) * 100;

            progressFill.style.width = percentage + '%';
            progressCount.textContent = `${explored} of ${total} explored`;
            progressTrack.setAttribute('aria-valuenow', explored);

            if (explored === total) {
                setTimeout(() => {
                    completionMessage.classList.add('show');
                    postHeight();
                }, 300);
            }
        }

        // Post height to parent frame
        function postHeight() {
            const height = document.documentElement.scrollHeight;
            window.parent.postMessage({ type: 'resize', height: height }, '*');
        }

        // Event listeners
        cards.forEach(card => {
            card.addEventListener('click', () => {
                const cardId = card.dataset.card;
                openModal(cardId);
            });

            // Keyboard navigation for cards
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const cardId = card.dataset.card;
                    openModal(cardId);
                }
            });
        });

        modalClose.addEventListener('click', closeModal);

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                closeModal();
            }
        });

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modalOverlay.classList.contains('active')) {
                closeModal();
            }
        });

        // Add focus trap listener to modal
        modal.addEventListener('keydown', trapFocus);

        // Initial height post
        window.addEventListener('load', postHeight);
        window.addEventListener('resize', postHeight);

        // Observe DOM changes for height updates
        const observer = new MutationObserver(postHeight);
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['class', 'style']
        });
    </script>
</body>
</html>
