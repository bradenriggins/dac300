<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1.2 Readiness Self‑Assessment — Texas RDA Exam</title>
  <style>
    /* =========================
       DAC 111–aligned visual system
       (colors extracted from exemplar)
       ========================= */
    :root{
      --blue-1:#01549e;      /* headings */
      --blue-2:#507ABB;      /* dividers */
      --accent-1:#be5510;    /* secondary hr / emphasis */
      --accent-2:#cb6015;    
      --teal:#0093b2;        /* highlights */
      --note-bg:#fbeeb8;     /* note background */
      --text:#0f172a;        
      --muted:#4b5563;
      --bg:#f8fafc;
      --card:#ffffff;
      --border:#e5e7eb;
    }

    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px 48px;}

    h1{font-size:clamp(1.4rem,2.2vw,1.9rem);margin:0 0 6px 0;color:var(--text);letter-spacing:.2px}
    .subtitle{color:var(--muted);margin:0 0 16px 0}

    /* Section headings match DAC 111: H3 + colored divider */
    h2{font-size:1.1rem;color:var(--blue-1);margin:24px 0 6px}
    .rule{border:0;border-top:2px solid var(--blue-2);margin:0 0 12px 0;padding-left:72px}
    .rule.orange{border-top-color:var(--accent-1)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.04);padding:18px 18px}
    .grid{display:grid;gap:14px}

    .meta{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 0}
    .badge{font-size:.85rem;background:rgba(1,84,158,.08);color:var(--blue-1);border:1px solid rgba(1,84,158,.22);padding:4px 8px;border-radius:999px}

    /* Details components (collapsible domains) */
    details{border:1px solid var(--border);border-radius:12px;background:var(--card)}
    details+details{margin-top:10px}
    summary{list-style:none;cursor:pointer;padding:14px 16px;display:flex;align-items:center;gap:10px}
    summary::-webkit-details-marker{display:none}
    .kicker{font-weight:600;color:var(--blue-1)}
    .summary-rule{border:0;border-top:2px solid var(--blue-2);margin:0 16px 0 72px}
    .summary-rule.orange{border-top-color:var(--accent-1)}

    .qs{padding:12px 16px 16px 16px;border-top:1px solid var(--border);display:grid;gap:12px}
    .q{display:grid;gap:6px}
    .q label{font-weight:600}

    /* Likert radios */
    .likert{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .likert input{display:none}
    .likert label{border:1px solid var(--border);padding:8px 10px;border-radius:10px;cursor:pointer;user-select:none}
    .likert input:checked + label{border-color:var(--blue-1);box-shadow:0 0 0 3px rgba(1,84,158,.15)}
    .pill{font-size:.82rem;color:var(--muted)}

    textarea{width:100%;min-height:68px;border:1px solid var(--border);border-radius:10px;padding:10px;resize:vertical;font:inherit}

    /* Toolbar */
    .toolbar{position:sticky;top:0;background:rgba(248,250,252,.7);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border);z-index:5}
    .toolbar-inner{max-width:980px;margin:0 auto;padding:8px 16px;display:flex;flex-wrap:wrap;gap:8px}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--blue-1);border-color:var(--blue-1);color:#fff}
    .btn.ghost{background:transparent}

    .progress{display:flex;align-items:center;gap:10px;margin-left:auto}
    .bar{width:140px;height:8px;border-radius:999px;background:#e9eff6;overflow:hidden}
    .bar > span{display:block;height:100%;background:linear-gradient(90deg,var(--blue-2),var(--teal));width:0}
    .pct{min-width:46px;text-align:right;font-variant-numeric:tabular-nums}

    /* Summary */
    .summary{margin-top:18px}
    .summary .stat{display:grid;grid-template-columns:140px 1fr;gap:10px}
    .scorebar{height:10px;background:#eef2f7;border-radius:999px;overflow:hidden}
    .scorebar > span{display:block;height:100%;background:linear-gradient(90deg,var(--accent-1),var(--teal));width:0}

    .note{background:var(--note-bg);border:1px solid #f3df93;border-radius:12px;padding:10px 12px}

    .footer{margin-top:22px;display:flex;flex-wrap:wrap;gap:8px}

    /* Responsive */
    @media (max-width:640px){
      .summary .stat{grid-template-columns:1fr}
      .bar{width:120px}
    }
  </style>
</head>
<body>
  <!-- Sticky toolbar: actions + progress -->
  <div class="toolbar">
    <div class="toolbar-inner">
      <button class="btn primary" id="viewSummaryBtn" type="button">View Summary</button>
      <button class="btn" id="copyBtn" type="button">Copy Results</button>
      <button class="btn ghost" id="downloadBtn" type="button">Download CSV</button>
      <button class="btn ghost" id="resetBtn" type="button">Reset</button>
      <div class="progress" aria-live="polite">
        <div class="bar" aria-hidden="true"><span id="barFill"></span></div>
        <div class="pct" id="pct">0%</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <header class="card">
      <h1>1.2 Readiness Self‑Assessment — Texas RDA Exam</h1>
      <p class="subtitle">Use this self‑assessment to estimate readiness across common RDA exam domains. Scores are private to you and saved in this browser. Your summary will generate a study focus list.</p>
      <div class="meta">
        <span class="badge">Estimated time: ~15 minutes</span>
        <span class="badge">Saved locally</span>
        <span class="badge">Accessible keyboard navigation</span>
      </div>
    </header>

    <section class="grid" id="formRoot" aria-label="Texas RDA Self‑Assessment">
      <!-- Domain 1 -->
      <details open>
        <summary>
          <span class="kicker">1) Radiographic Principles & Physics</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d1q1">Understands X‑ray generation, beam characteristics, and factors that affect image quality (kVp, mA, exposure time).</label>
            <div class="likert" role="group" aria-label="d1q1 options">
              <input type="radio" name="d1q1" id="d1q1-1" value="1"><label for="d1q1-1">1</label>
              <input type="radio" name="d1q1" id="d1q1-2" value="2"><label for="d1q1-2">2</label>
              <input type="radio" name="d1q1" id="d1q1-3" value="3"><label for="d1q1-3">3</label>
              <input type="radio" name="d1q1" id="d1q1-4" value="4"><label for="d1q1-4">4</label>
              <input type="radio" name="d1q1" id="d1q1-5" value="5"><label for="d1q1-5">5</label>
              <span class="pill">1 = not ready · 5 = confident</span>
            </div>
          </div>
          <div class="q">
            <label for="d1q2">Can identify common image faults related to exposure/contrast and propose corrections.</label>
            <div class="likert" role="group" aria-label="d1q2 options">
              <input type="radio" name="d1q2" id="d1q2-1" value="1"><label for="d1q2-1">1</label>
              <input type="radio" name="d1q2" id="d1q2-2" value="2"><label for="d1q2-2">2</label>
              <input type="radio" name="d1q2" id="d1q2-3" value="3"><label for="d1q2-3">3</label>
              <input type="radio" name="d1q2" id="d1q2-4" value="4"><label for="d1q2-4">4</label>
              <input type="radio" name="d1q2" id="d1q2-5" value="5"><label for="d1q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d1n">Notes (optional)</label>
            <textarea id="d1n" placeholder="Add any quick notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 2 -->
      <details>
        <summary>
          <span class="kicker">2) Exposure & Technique / Positioning</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d2q1">Positions sensors/film accurately for periapical, bitewing, and occlusal images (paralleling and bisecting angle techniques).</label>
            <div class="likert" role="group" aria-label="d2q1 options">
              <input type="radio" name="d2q1" id="d2q1-1" value="1"><label for="d2q1-1">1</label>
              <input type="radio" name="d2q1" id="d2q1-2" value="2"><label for="d2q1-2">2</label>
              <input type="radio" name="d2q1" id="d2q1-3" value="3"><label for="d2q1-3">3</label>
              <input type="radio" name="d2q1" id="d2q1-4" value="4"><label for="d2q1-4">4</label>
              <input type="radio" name="d2q1" id="d2q1-5" value="5"><label for="d2q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d2q2">Prevents common errors (cone‑cut, elongation/foreshortening, overlapping contacts) and can troubleshoot.</label>
            <div class="likert" role="group" aria-label="d2q2 options">
              <input type="radio" name="d2q2" id="d2q2-1" value="1"><label for="d2q2-1">1</label>
              <input type="radio" name="d2q2" id="d2q2-2" value="2"><label for="d2q2-2">2</label>
              <input type="radio" name="d2q2" id="d2q2-3" value="3"><label for="d2q2-3">3</label>
              <input type="radio" name="d2q2" id="d2q2-4" value="4"><label for="d2q2-4">4</label>
              <input type="radio" name="d2q2" id="d2q2-5" value="5"><label for="d2q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d2n">Notes (optional)</label>
            <textarea id="d2n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 3 -->
      <details>
        <summary>
          <span class="kicker">3) Image Processing & Digital Systems</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d3q1">Understands digital sensors/plates, scanning, processing, and basic image adjustments while preserving diagnostic value.</label>
            <div class="likert" role="group" aria-label="d3q1 options">
              <input type="radio" name="d3q1" id="d3q1-1" value="1"><label for="d3q1-1">1</label>
              <input type="radio" name="d3q1" id="d3q1-2" value="2"><label for="d3q1-2">2</label>
              <input type="radio" name="d3q1" id="d3q1-3" value="3"><label for="d3q1-3">3</label>
              <input type="radio" name="d3q1" id="d3q1-4" value="4"><label for="d3q1-4">4</label>
              <input type="radio" name="d3q1" id="d3q1-5" value="5"><label for="d3q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d3q2">Recognizes artifacts from processing/handling and applies corrective steps.</label>
            <div class="likert" role="group" aria-label="d3q2 options">
              <input type="radio" name="d3q2" id="d3q2-1" value="1"><label for="d3q2-1">1</label>
              <input type="radio" name="d3q2" id="d3q2-2" value="2"><label for="d3q2-2">2</label>
              <input type="radio" name="d3q2" id="d3q2-3" value="3"><label for="d3q2-3">3</label>
              <input type="radio" name="d3q2" id="d3q2-4" value="4"><label for="d3q2-4">4</label>
              <input type="radio" name="d3q2" id="d3q2-5" value="5"><label for="d3q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d3n">Notes (optional)</label>
            <textarea id="d3n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 4 -->
      <details>
        <summary>
          <span class="kicker">4) Radiation Safety & Quality Assurance</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d4q1">Applies ALARA principles, proper shielding, distances, and exposure settings for patient and operator safety.</label>
            <div class="likert" role="group" aria-label="d4q1 options">
              <input type="radio" name="d4q1" id="d4q1-1" value="1"><label for="d4q1-1">1</label>
              <input type="radio" name="d4q1" id="d4q1-2" value="2"><label for="d4q1-2">2</label>
              <input type="radio" name="d4q1" id="d4q1-3" value="3"><label for="d4q1-3">3</label>
              <input type="radio" name="d4q1" id="d4q1-4" value="4"><label for="d4q1-4">4</label>
              <input type="radio" name="d4q1" id="d4q1-5" value="5"><label for="d4q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d4q2">Follows equipment maintenance/quality assurance checks and documentation requirements.</label>
            <div class="likert" role="group" aria-label="d4q2 options">
              <input type="radio" name="d4q2" id="d4q2-1" value="1"><label for="d4q2-1">1</label>
              <input type="radio" name="d4q2" id="d4q2-2" value="2"><label for="d4q2-2">2</label>
              <input type="radio" name="d4q2" id="d4q2-3" value="3"><label for="d4q2-3">3</label>
              <input type="radio" name="d4q2" id="d4q2-4" value="4"><label for="d4q2-4">4</label>
              <input type="radio" name="d4q2" id="d4q2-5" value="5"><label for="d4q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d4n">Notes (optional)</label>
            <textarea id="d4n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 5 -->
      <details>
        <summary>
          <span class="kicker">5) Infection Control in Dental Radiography</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d5q1">Implements proper barrier techniques, sensor/film handling, and operatory disinfection for radiographic procedures.</label>
            <div class="likert" role="group" aria-label="d5q1 options">
              <input type="radio" name="d5q1" id="d5q1-1" value="1"><label for="d5q1-1">1</label>
              <input type="radio" name="d5q1" id="d5q1-2" value="2"><label for="d5q1-2">2</label>
              <input type="radio" name="d5q1" id="d5q1-3" value="3"><label for="d5q1-3">3</label>
              <input type="radio" name="d5q1" id="d5q1-4" value="4"><label for="d5q1-4">4</label>
              <input type="radio" name="d5q1" id="d5q1-5" value="5"><label for="d5q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d5q2">Follows hand hygiene, PPE selection, and waste management appropriate to imaging tasks.</label>
            <div class="likert" role="group" aria-label="d5q2 options">
              <input type="radio" name="d5q2" id="d5q2-1" value="1"><label for="d5q2-1">1</label>
              <input type="radio" name="d5q2" id="d5q2-2" value="2"><label for="d5q2-2">2</label>
              <input type="radio" name="d5q2" id="d5q2-3" value="3"><label for="d5q2-3">3</label>
              <input type="radio" name="d5q2" id="d5q2-4" value="4"><label for="d5q2-4">4</label>
              <input type="radio" name="d5q2" id="d5q2-5" value="5"><label for="d5q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d5n">Notes (optional)</label>
            <textarea id="d5n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 6 -->
      <details>
        <summary>
          <span class="kicker">6) Anatomy, Pathology Recognition & Interpretation</span>
        </summary>
        <hr class="summary-rule" />
        <div class="qs">
          <div class="q">
            <label for="d6q1">Recognizes normal anatomical landmarks on intraoral and panoramic images.</label>
            <div class="likert" role="group" aria-label="d6q1 options">
              <input type="radio" name="d6q1" id="d6q1-1" value="1"><label for="d6q1-1">1</label>
              <input type="radio" name="d6q1" id="d6q1-2" value="2"><label for="d6q1-2">2</label>
              <input type="radio" name="d6q1" id="d6q1-3" value="3"><label for="d6q1-3">3</label>
              <input type="radio" name="d6q1" id="d6q1-4" value="4"><label for="d6q1-4">4</label>
              <input type="radio" name="d6q1" id="d6q1-5" value="5"><label for="d6q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d6q2">Identifies common pathologies/findings (caries classes, calculus, periapical changes) and when to notify the dentist.</label>
            <div class="likert" role="group" aria-label="d6q2 options">
              <input type="radio" name="d6q2" id="d6q2-1" value="1"><label for="d6q2-1">1</label>
              <input type="radio" name="d6q2" id="d6q2-2" value="2"><label for="d6q2-2">2</label>
              <input type="radio" name="d6q2" id="d6q2-3" value="3"><label for="d6q2-3">3</label>
              <input type="radio" name="d6q2" id="d6q2-4" value="4"><label for="d6q2-4">4</label>
              <input type="radio" name="d6q2" id="d6q2-5" value="5"><label for="d6q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d6n">Notes (optional)</label>
            <textarea id="d6n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>

      <!-- Domain 7 -->
      <details>
        <summary>
          <span class="kicker">7) Texas Jurisprudence & Ethics (RDA‑related)</span>
        </summary>
        <hr class="summary-rule orange" />
        <div class="qs">
          <div class="q">
            <label for="d7q1">Understands scope of practice, supervision levels, and documentation expectations relevant to dental radiography in Texas.</label>
            <div class="likert" role="group" aria-label="d7q1 options">
              <input type="radio" name="d7q1" id="d7q1-1" value="1"><label for="d7q1-1">1</label>
              <input type="radio" name="d7q1" id="d7q1-2" value="2"><label for="d7q1-2">2</label>
              <input type="radio" name="d7q1" id="d7q1-3" value="3"><label for="d7q1-3">3</label>
              <input type="radio" name="d7q1" id="d7q1-4" value="4"><label for="d7q1-4">4</label>
              <input type="radio" name="d7q1" id="d7q1-5" value="5"><label for="d7q1-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d7q2">Recognizes patient rights, informed consent, and privacy considerations when obtaining radiographic images.</label>
            <div class="likert" role="group" aria-label="d7q2 options">
              <input type="radio" name="d7q2" id="d7q2-1" value="1"><label for="d7q2-1">1</label>
              <input type="radio" name="d7q2" id="d7q2-2" value="2"><label for="d7q2-2">2</label>
              <input type="radio" name="d7q2" id="d7q2-3" value="3"><label for="d7q2-3">3</label>
              <input type="radio" name="d7q2" id="d7q2-4" value="4"><label for="d7q2-4">4</label>
              <input type="radio" name="d7q2" id="d7q2-5" value="5"><label for="d7q2-5">5</label>
            </div>
          </div>
          <div class="q">
            <label for="d7n">Notes (optional)</label>
            <textarea id="d7n" placeholder="Notes for this domain..."></textarea>
          </div>
        </div>
      </details>
    </section>

    <!-- Summary / Results -->
    <section class="card summary" id="summary" aria-live="polite" hidden>
      <h2>Summary</h2>
      <hr class="rule" />
      <div id="stats" class="grid"></div>
      <div class="note" style="margin-top:12px">
        <strong>Tip:</strong> Focus first on domains with average scores below 3.0. Build short, targeted practice blocks alongside externship tasks.
      </div>
      <div class="footer">
        <button class="btn primary" type="button" onclick="window.print()">Print</button>
        <button class="btn" type="button" id="genPlanBtn">Generate Study Focus</button>
      </div>
      <div id="plan" style="margin-top:10px"></div>
    </section>

  </div>

  <script>
    /* =========================
       State & persistence
       ========================= */
    const KEY = 'dac300-tx-rda-12-v1';
    const domains = [
      { id:'d1', name:'Radiographic Principles & Physics' },
      { id:'d2', name:'Exposure & Technique / Positioning' },
      { id:'d3', name:'Image Processing & Digital Systems' },
      { id:'d4', name:'Radiation Safety & Quality Assurance' },
      { id:'d5', name:'Infection Control in Dental Radiography' },
      { id:'d6', name:'Anatomy, Pathology Recognition & Interpretation' },
      { id:'d7', name:'Texas Jurisprudence & Ethics' }
    ];

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function save(){
      const data = {};
      domains.forEach(d => {
        data[d.id] = {
          q: [1,2].map(n => {
            const v = $$(`input[name="${d.id}q${n}"]:checked`)[0]?.value || '';
            return v;
          }),
          n: $(`#${d.id}n`)?.value || ''
        };
      });
      localStorage.setItem(KEY, JSON.stringify(data));
      return data;
    }

    function load(){
      try{
        const data = JSON.parse(localStorage.getItem(KEY) || '{}');
        domains.forEach(d => {
          if(!data[d.id]) return;
          (data[d.id].q||[]).forEach((v,idx)=>{
            if(v){
              const r = document.getElementById(`${d.id}q${idx+1}-${v}`);
              if(r) r.checked = true;
            }
          })
          if(data[d.id].n && document.getElementById(`${d.id}n`)){
            document.getElementById(`${d.id}n`).value = data[d.id].n;
          }
        });
      }catch(e){}
    }

    function calc(){
      const stats = [];
      let answered = 0, total = 0;
      domains.forEach(d => {
        const vals = [];
        [1,2].forEach(n => {
          const el = $$(`input[name="${d.id}q${n}"]:checked`)[0];
          if(el){
            vals.push(Number(el.value));
            answered++;
          }
          total++;
        })
        const avg = vals.length ? (vals.reduce((a,b)=>a+b,0)/vals.length) : 0;
        stats.push({ id:d.id, name:d.name, avg:avg });
      });
      return { stats, answered, total };
    }

    function renderProgress(){
      const {answered,total} = calc();
      const pct = total ? Math.round((answered/total)*100) : 0;
      $('#pct').textContent = pct + '%';
      $('#barFill').style.width = pct + '%';
    }

    function band(avg){
      if(avg === 0) return {label:'No data', color:'#cbd5e1'};
      if(avg < 2.5) return {label:'Focus', color: getComputedStyle(document.documentElement).getPropertyValue('--accent-1') };
      if(avg < 3.5) return {label:'Reinforce', color: getComputedStyle(document.documentElement).getPropertyValue('--blue-2') };
      return {label:'Strength', color: getComputedStyle(document.documentElement).getPropertyValue('--teal') };
    }

    function renderSummary(){
      const {stats} = calc();
      const box = $('#stats');
      box.innerHTML = '';
      stats.forEach(s => {
        const b = band(s.avg);
        const pct = Math.round((s.avg/5)*100);
        const row = document.createElement('div');
        row.className = 'card';
        row.innerHTML = `
          <div class="stat">
            <div><strong>${s.name}</strong><div class="pill">${s.avg ? s.avg.toFixed(2)+'/5 · '+b.label : '—'}</div></div>
            <div>
              <div class="scorebar"><span style="width:${pct}%"></span></div>
            </div>
          </div>
        `;
        box.appendChild(row);
      });
      $('#summary').hidden = false;
      window.scrollTo({top: $('#summary').offsetTop - 12, behavior:'smooth'});
    }

    function genPlan(){
      const {stats} = calc();
      const sorted = stats.filter(s=>s.avg>0).sort((a,b)=>a.avg-b.avg);
      const focus = sorted.slice(0,3);
      const el = $('#plan');
      if(!focus.length){ el.innerHTML = '<p class="subtitle">Answer a few items to generate a focus list.</p>'; return; }
      const items = focus.map((s,i)=>`<li><strong>${i+1}. ${s.name}</strong> — plan two short practice blocks (15–20 min) and one externship tie‑in task this week.</li>`).join('');
      el.innerHTML = `
        <h2>Suggested Study Focus (Top Gaps)</h2>
        <hr class="rule orange" />
        <ol>${items}</ol>
      `;
    }

    function toCSV(){
      const data = JSON.parse(localStorage.getItem(KEY) || '{}');
      const {stats} = calc();
      const rows = [['Domain','Question','Score','Notes']];
      domains.forEach(d=>{
        [1,2].forEach(n=>{
          const score = data[d.id]?.q?.[n-1] || '';
          rows.push([d.name, `Q${n}`, score, (data[d.id]?.n||'').replace(/\n/g,' ') ]);
        })
      })
      rows.push([]);
      stats.forEach(s=>rows.push(['Average', s.name, s.avg ? s.avg.toFixed(2) : '', '']))
      return rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
    }

    function downloadCSV(){
      const csv = toCSV();
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'DAC300_W1_Texas_RDA_SelfAssessment.csv';
      document.body.appendChild(a); a.click(); a.remove();
    }

    function copySummary(){
      const {stats} = calc();
      const lines = stats.map(s=>`${s.name}: ${s.avg ? s.avg.toFixed(2)+'/5' : '—'}`);
      const txt = 'Texas RDA Self‑Assessment\n' + lines.join('\n');
      navigator.clipboard.writeText(txt).then(()=>{
        const old = $('#copyBtn').textContent; $('#copyBtn').textContent='Copied!'; setTimeout(()=>$('#copyBtn').textContent=old,1000);
      }).catch(()=>{});
    }

    function resetAll(){
      localStorage.removeItem(KEY);
      $$('input[type=radio]').forEach(r=>r.checked=false);
      $$('textarea').forEach(t=>t.value='');
      renderProgress();
      $('#summary').hidden = true;
      $('#plan').innerHTML='';
    }

    // Listeners
    document.addEventListener('change', () => { save(); renderProgress(); });
    document.addEventListener('input', () => { save(); });
    $('#viewSummaryBtn').addEventListener('click', renderSummary);
    $('#genPlanBtn').addEventListener('click', genPlan);
    $('#downloadBtn').addEventListener('click', downloadCSV);
    $('#copyBtn').addEventListener('click', copySummary);
    $('#resetBtn').addEventListener('click', resetAll);

    // Init
    load();
    renderProgress();
  </script>
</body>
</html>
